<!DOCTYPE html>
<html lang="es">
  <%- include("../partials/head") %>
  <body>
    <div class="page-container">
      <%- include("../partials/header") %>

      <main class="content">
        <section class="login">
          <h1>Iniciar Sesión</h1>

          <% if (errorMessage) { %>
            <p class="error-text"><%= errorMessage %></p>
          <% } %>

          <form action="/users/login" method="POST" class="login-form" onsubmit="return validateLoginForm()">
            <div class="form-group">
              <label for="email">Correo Electrónico:</label>
              <input type="email" id="email" name="email" value="<%= oldEmail ? oldEmail : '' %>" required autocomplete="email" />
              <span class="error-text" id="email_error"></span>
            </div>

            <div class="form-group">
              <label for="password">Contraseña:</label>
              <input type="password" id="password" name="password" required autocomplete="current-password" />
              <span class="error-text" id="password_error"></span>
            </div>

            <button type="submit" class="cta-buttonLogin">Iniciar Sesión</button>
          </form>
        </section>
      </main>

      <%- include("../partials/footer") %>
    </div>

    <script>
      function validateLoginForm() {
        let isValid = true;

        function showError(id, message) {
          const errorElement = document.getElementById(id);
          errorElement.textContent = message;
          errorElement.style.color = "red"; 
        }

        document.querySelectorAll(".error-text").forEach(e => e.textContent = "");

        const email = document.getElementById("email").value.trim();
        const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
        if (!emailPattern.test(email)) {
          showError("email_error", "El correo debe tener un formato válido.");
          isValid = false;
        }

        const password = document.getElementById("password").value.trim();
        if (password.length === 0) {
          showError("password_error", "La contraseña es obligatoria.");
          isValid = false;
        }

        return isValid;
      }
    </script>
  </body>
</html>