<!DOCTYPE html>
<html lang="es">
<%- include('../partials/head') %>
<body>
  <div class="page-container">
    <%- include('../partials/header') %>
    <main class="content">
      <section class="form-container">
        <h1>Editar Producto</h1>

        <% if (!product) { %>
          <p class="error-message">Error: No se encontró el producto.</p>
        <% } else { %>

        <!-- Mostrar errores generales si los hay -->
        <% if (typeof errors !== 'undefined' && Object.keys(errors).length > 0) { %>
          <div class="error-messages">
            <% Object.values(errors).forEach(error => { %>
              <p class="error-text"><%= error.msg %></p>
            <% }); %>
          </div>
        <% } %>

        <form action="/products/<%= product.productId %>/edit" method="POST" enctype="multipart/form-data">
          <div class="form-group">
            <label for="product_name">Nombre del Producto:</label>
            <input
              type="text"
              id="product_name"
              name="product_name"
              value="<%= typeof product_name !== 'undefined' ? product_name : product.product_name %>"
              required
              minlength="5"
            />
            <% if (errors && errors.product_name) { %>
              <span class="error-message"><%= errors.product_name.msg %></span>
            <% } %>
          </div>

          <div class="form-group">
            <label for="description">Descripción:</label>
            <textarea id="description" name="description" required minlength="20">
              <%= typeof description !== 'undefined' ? description : product.description %>
            </textarea>
            <% if (errors && errors.description) { %>
              <span class="error-message"><%= errors.description.msg %></span>
            <% } %>
          </div>

          <div class="form-group">
            <label for="price">Precio:</label>
            <input
              type="number"
              id="price"
              name="price"
              step="0.01"
              value="<%= typeof price !== 'undefined' ? price : product.price %>"
              required
              min="0.01"
            />
            <% if (errors && errors.price) { %>
              <span class="error-message"><%= errors.price.msg %></span>
            <% } %>
          </div>

          <div class="form-group">
            <label for="category_id">Categoría:</label>
            <select id="category_id" name="category_id" required>
              <% if (typeof categories !== 'undefined' && Array.isArray(categories) && categories.length > 0) { %>
                <% categories.forEach(category => { %>
                  <option value="<%= category.categoryId %>"
                    <%= typeof category_id !== 'undefined' && category_id == category.categoryId ? 'selected' : (product.category_id == category.categoryId ? 'selected' : '') %>>
                    <%= category.name_category %>
                  </option>
                <% }); %>
              <% } else { %>
                <option value="">No hay categorías disponibles</option>
              <% } %>
            </select>
            <% if (errors && errors.category_id) { %>
              <span class="error-message"><%= errors.category_id.msg %></span>
            <% } %>
          </div>

          <div class="form-group">
            <label for="product_image">Imagen del Producto:</label>
            <input type="file" id="product_image" name="product_image" accept=".jpg, .jpeg, .png, .gif" />
            <% if (errors && errors.product_image) { %>
              <span class="error-message"><%= errors.product_image.msg %></span>
            <% } %>

            
            <% if (product.product_image) { %>
              <div class="current-image">
                <p>Imagen actual:</p>
                <img src="/images/products/<%= product.product_image %>" alt="Imagen del producto" class="product-img-preview"/>
              </div>
            <% } %>
          </div>

          <button type="submit" class="cta-buttonForm">Guardar Cambios</button>
        </form>
        <% } %>
      </section>
    </main>
    <%- include('../partials/footer') %>
  </div>
</body>
<script src="/js/scripts.js"></script>
</html>